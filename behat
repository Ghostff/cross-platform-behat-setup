#!/usr/bin/env php
<?php

$arguments = $argv;
array_shift($arguments);

$ds = DIRECTORY_SEPARATOR;

$selenium = @fsockopen('localhost', 4444);
if ($selenium !== false) {
    fclose($selenium);
}
else {
    $path   = str_replace('/', $ds, 'tests/behat/drivers/');
    $log    = str_replace('/', $ds, 'tests/behat/logs');
    $server = 'selenium-server-standalone-3.141.59.jar';

    if ($ds == '/') {
        // Firefox Linux
        shell_exec("java -jar -Dwebdriver.gecko.driver={$path}geckodriver {$path}{$server} -log {$log}selenium.log > /dev/null 2>&1 &");
    } else {
        // Firefox Windows
        pclose(popen("start /B  java -jar  -Dwebdriver.gecko.driver={$path}geckodriver.exe {$path}{$server} -log {$log}selenium.log", 'r'));
    }

    // Firefox
//    pclose(popen("start /B java -jar -Dwebdriver.gecko.driver={$path}geckodriver.exe {$path}{$server} -log m.log", 'r'));
//    shell_exec("java -jar -Dwebdriver.gecko.driver={$path}geckodriver.exe {$path}{$server} -log m.log &");

    // Chrome
    // shell_exec("java -jar -Dwebdriver.chrome.driver={$path}chromedriver {$path}{$server} > /dev/null 2>&1 &");
}

system(str_replace('/', $ds, 'vendor/bin/behat --colors ' ) . implode(' ', $arguments));
# https://medium.com/@glennmcewan/selenium-setup-2c598b95bee1
